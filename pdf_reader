import re
from pdfminer.high_level import extract_pages, extract_text
import geonamescache
import pycountry

gc = geonamescache.GeonamesCache()
cities = gc.get_cities()
state_list = list(pycountry.countries) 
city_names = set(city['name'] for city in cities.values())

"""for page_layout in extract_pages("invoice.pdf"):
    for element in page_layout:
        print(element)"""
        
text = extract_text("invoice_3.pdf")



#print(customer)

delivery = text.find("Delivery")
end = text.find("Payment")

delivery_adress = text[delivery:end-1]

incoterm_list = ["EXW","FOB","FCA","CFR","CPT","CIF","CIP","DAP","DDP"]

def incoterm_overlook(incoterm_list):
    for i in incoterm_list:
        found = int(text.find(i))
        if found != -1:
            if i == "DDP" and text[found+4] == "V":
                return "DDP VAT Unpaid"
            else:
                return i

def find_city(delivery_adress):
    tokenized = delivery_adress.split()
    if "Asahi" in tokenized:
        tokenized.remove("Asahi")
    for i in tokenized:
        if gc.get_cities_by_name(i):
            return i
    
    

def find_state_code():
    tokenized = delivery_adress.split()
    for i in tokenized:
        if i in [country.alpha_2 for country in pycountry.countries]:
            return i 
            
    




founded_inco = incoterm_overlook(incoterm_list)
founded_city = find_city(delivery_adress)
founded_state = find_state_code()
"""delivery_note =
invoice_num = 
zb =
"""
print(text)
print(founded_inco)
print(founded_city)
print(founded_state)


