import re
from pdfminer.high_level import extract_pages, extract_text
import geonamescache

gc = geonamescache.GeonamesCache()
cities = gc.get_cities()

city_names = set(city['name'] for city in cities.values())

"""for page_layout in extract_pages("invoice.pdf"):
    for element in page_layout:
        print(element)"""
        
text = extract_text("invoice.pdf")

customer = re.compile("Delivery Adress:")

#print(customer)

delivery = text.find("Delivery")
end = text.find("Payment")

delivery_adress = text[delivery:end-1]

incoterm_list = ["EXW","FOB","FCA","CFR","CPT","CIF","CIP","DAP","DDP"]

def incoterm_overlook(incoterm_list):
    for i in incoterm_list:
        found = int(text.find(i))
        if found != -1:
            if i == "DDP" and text[found+4] == "V":
                return "DDP VAT Unpaid"
            else:
                return i

def find_city(delivery_adress):
    tokenized = delivery_adress.split()
    for i in tokenized:
        #if print(len(gc.search_cities(i,case_sensitive=False))) != 0:
        if i in gc.get_cities_by_name(i):
            return i
        
        




founded_inco = incoterm_overlook(incoterm_list)
founded_city = find_city(delivery_adress)

"""print(delivery_adress)
print(founded_inco)"""
print(founded_city)
print(cities)
"""result = gc.search_cities("kudasesgsr", case_sensitive= False)
if result != None:
    print(result)"""
#print(gc.search_cities('Dubai', case_sensitive=False))